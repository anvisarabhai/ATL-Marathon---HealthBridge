<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Bridge - Auto & Cab Dispatch</title>
    <link rel="icon" type="image/x-icon" href="logo.jpg" alt="Health Bridge Logo">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;700;900&family=Open+Sans:wght@400;600&display=swap');

        :root {
            --primary-dark: #343D54;
            --accent-color: #A88EAE; /* PRIMARY from style.css (Purple) */
            --light-accent: #C7B9CC; /* LIGHT ACCENT from style.css (Light Purple) */
            --background-color: #F7F7F7;
            --surface-color: #FFFFFF;
            --text-color-dark: #444444;
            --text-color-light: #FFFFFF;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --success-green: #5CB85C; /* Kept for success status */
            --cancel-dark: #6C757D; /* Kept for cancel status */
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Open Sans', sans-serif;
            color: var(--text-color-dark);
            background-color: var(--background-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 80px; 
            box-sizing: border-box;
        }

        main {
            width: 100%;
            max-width: 1200px;
            padding: 0 20px;
            margin: 0 auto;
        }

        /* --- Navbar Styles (Inherited) --- */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: var(--primary-dark);
            color: var(--text-color-light);
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 20;
        }

        .logo {
            font-family: 'Raleway', sans-serif;
            font-weight: 900;
            font-size: 1.8rem;
            color: var(--text-color-light);
        }

        .nav-links {
            list-style: none;
            display: flex;
            gap: 20px;
            margin: 0;
            padding: 0;
        }

        .nav-links a {
            color: var(--text-color-light);
            text-decoration: none;
            font-weight: 400;
            padding: 5px 10px;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--light-accent);
        }

        /* --- Banner & CTA Styles --- */
        .banner {
            background-color: var(--surface-color); 
            border: 2px solid var(--accent-color); 
            padding: 40px 20px;
            border-radius: 12px;
            box-shadow: 0 2px 5px var(--shadow-color);
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px; /* Reduced gap since immediate button is gone */
            text-align: center;
        }

        .banner h1 {
            font-family: 'Raleway', sans-serif;
            font-weight: 900;
            font-size: 2.5rem;
            color: var(--primary-dark); 
            margin: 0 0 10px;
        }

        .tagline {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--accent-color); 
            margin-bottom: 10px; /* Added margin for separation */
        }

        .cta-btn {
            display: inline-block;
            padding: 12px 25px;
            font-family: 'Raleway', sans-serif;
            font-weight: 700;
            text-decoration: none;
            color: var(--text-color-light);
            background-color: var(--accent-color);
            border-radius: 8px;
            transition: background-color 0.3s ease, transform 0.1s;
            text-transform: uppercase;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            margin: 5px; 
            box-shadow: 0 4px 10px rgba(168, 142, 174, 0.4); 
        }

        .cta-btn:hover {
            background-color: #927D98; /* Darker shade */
            transform: translateY(-1px);
        }
        
        /* Primary transport button style */
        .cta-btn.primary-transport {
            background-color: var(--accent-color);
        }

        .cta-btn.primary-transport:hover {
            background-color: #927D98;
        }
        
        /* Immediate Dispatch Button Styles are removed as per request */

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(168, 142, 174, 0.7); } 
            70% { box-shadow: 0 0 0 10px rgba(168, 142, 174, 0); }
            100% { box-shadow: 0 0 0 0 rgba(168, 142, 174, 0); }
        }

        /* --- Form and Step Styles --- */

        .form-card {
            background-color: var(--surface-color);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: 30px auto;
        }

        /* Step Indicator */
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

        .step-indicator::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 10%;
            right: 10%;
            height: 3px;
            background-color: var(--light-accent);
            z-index: 1;
            transform: translateY(-50%);
        }

        .step-item {
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--light-accent);
            color: var(--text-color-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-bottom: 5px;
            transition: background-color 0.3s;
            border: 3px solid var(--surface-color);
            box-shadow: 0 0 0 2px var(--light-accent);
        }

        .step-item.active .step-circle {
            background-color: var(--accent-color);
            box-shadow: 0 0 0 3px var(--accent-color);
        }

        .step-item.complete .step-circle {
            background-color: var(--success-green);
            box-shadow: 0 0 0 3px var(--success-green);
        }

        .step-label {
            font-size: 0.85rem;
            color: var(--text-color-dark);
            text-align: center;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: var(--primary-dark);
            font-size: 1rem;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--light-accent);
            border-radius: 6px;
            box-sizing: border-box;
            font-family: 'Open Sans', sans-serif;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group textarea:focus {
            border-color: var(--accent-color);
            outline: none;
        }

        /* Disclaimer/Alert specific Styles */
        .transport-disclaimer {
            background-color: var(--background-color); 
            border: 1px solid var(--light-accent); 
            color: var(--primary-dark);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            text-align: center;
        }

        .confirmation-summary {
            background-color: var(--background-color);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .confirmation-summary p {
            margin: 10px 0;
            padding-bottom: 5px;
            border-bottom: 1px dashed var(--light-accent);
        }
        
        .confirmation-summary p:last-child {
            border-bottom: none;
        }

        .confirmation-summary strong {
            color: var(--primary-dark);
        }

        .dispatch-status {
            text-align: center;
            padding: 40px 20px;
            border-radius: 12px;
            background-color: var(--surface-color);
            border: 3px solid var(--accent-color); 
        }

        .dispatch-status.canceled {
            border: 3px solid var(--cancel-dark);
        }

        .dispatch-status h2 {
            font-family: 'Raleway', sans-serif;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .dispatch-status h2.success {
             color: var(--success-green);
        }
        
        .dispatch-status h2.cancel {
             color: var(--cancel-dark);
        }

        .dispatch-status .eta {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--primary-dark);
            margin: 20px 0;
            display: block;
        }

        .dispatch-status .small-text {
            font-size: 0.9rem;
            color: #666;
        }
        
        /* Vehicle Selection Styles */
        .vehicle-selection {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .vehicle-option {
            flex-grow: 1;
            padding: 15px;
            border: 2px solid var(--light-accent);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
            position: relative;
            background-color: var(--background-color);
        }
        
        .vehicle-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }
        
        .vehicle-option label {
            display: block;
            margin: 0;
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .vehicle-option .fare {
            display: block;
            font-weight: 900;
            font-size: 1.5rem;
            color: var(--accent-color);
            margin-top: 5px;
        }

        .vehicle-option input[type="radio"]:checked + label {
            border: 2px solid var(--accent-color); 
            background-color: var(--light-accent); 
            box-shadow: 0 0 8px rgba(168, 142, 174, 0.5); 
        }
        
        .vehicle-option input[type="radio"]:checked + label .fare {
            color: var(--primary-dark);
        }
        
        /* --- Responsive Adjustments --- */
        @media (max-width: 600px) {
            .vehicle-selection {
                flex-direction: column;
            }
            .navbar {
                padding: 15px 20px;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">Health Bridge</div>
        <ul class="nav-links">
            <li><a href="index.html">Home Page</a></li>
            <li><a href="about.html">About Us</a></li>
        </ul>
    </nav>

    <main>
        <div class="banner">
            <h1>AUTO & CAB TRANSPORT</h1>
            <p class="tagline">Reliable, Non-Emergency Transport Service For Minor Medical Problems</p>
            
            <p style="font-size: 1.1rem; margin-top: 10px; font-weight: 600;">
                Fill out the form below to plan your trip and confirm pricing.
            </p>
        </div>

        <div class="form-card" id="transport-system">

            <div class="step-indicator">
                <div id="step1-item" class="step-item">
                    <div class="step-circle">1</div>
                    <div class="step-label">Trip Details</div>
                </div>
                <div id="step2-item" class="step-item">
                    <div class="step-circle">2</div>
                    <div class="step-label">Review Fare</div>
                </div>
                <div id="step3-item" class="step-item">
                    <div class="step-circle">3</div>
                    <div class="step-label">Ride Status</div>
                </div>
            </div>

            <div id="step-content">
                </div>

        </div>
    </main>

    <script>
        // Define vehicle types and their simulated rates in Rupees (INR)
        // Simulated distance is 3-8 miles (approx 5-13 km)
        const VEHICLE_RATES = {
            // Cab: Base ₹80 + ₹40 per mile = Total ₹200 to ₹400
            Cab: { rate: 40, name: 'Cab (Comfort)', icon: '🚗', base: 80 },
            // Auto: Base ₹40 + ₹20 per mile = Total ₹100 to ₹200
            Auto: { rate: 20, name: 'Auto (Budget)', icon: '🛵', base: 40 }
        };
        
        // Define a constant for the initial state for easy reset
        const initialDispatchState = {
            currentStep: 1,
            dispatchData: {
                pickup: '',
                dropoff: '',
                vehicleType: 'Cab', // Default to Cab
                contact: '',
                fare: '0.00',
                distance: 0
            },
            isLive: false,
            timestamp: 0,
            etaMinutes: 0,
            status: ''
        };

        // Global state object, initialized with a clean state on every page load
        let dispatchState = { ...initialDispatchState };

        let dispatchInterval = null;

        const stepContent = document.getElementById('step-content');

        // --- Core Logic ---

        function calculateFare(type) {
            // Simulate a random distance between 3 and 8 miles
            const simulatedDistance = Math.floor(Math.random() * 6) + 3; 
            const config = VEHICLE_RATES[type];
            
            // Fare = Base Fee + (Distance * Rate)
            const tripFare = config.base + (simulatedDistance * config.rate);
            
            // Store distance for confirmation and return formatted fare
            dispatchState.dispatchData.distance = simulatedDistance;
            return Math.round(tripFare).toFixed(0); // Round to nearest whole rupee
        }

        function clearDispatchState(andRender = true) {
            if (dispatchInterval) {
                clearInterval(dispatchInterval);
                dispatchInterval = null;
            }
            const previousStatus = dispatchState.status;
            dispatchState = { ...initialDispatchState };
            
            if (andRender) {
                renderStep(1); 
            } else {
                 dispatchState.status = previousStatus;
            }
        }
        
        function initializeApp() {
            renderStep(1);
        }

        // --- Step Rendering Functions ---

        function updateStepIndicator() {
            document.querySelectorAll('.step-item').forEach((item, index) => {
                item.classList.remove('active', 'complete');
                const step = index + 1;
                if (step < dispatchState.currentStep) {
                    item.classList.add('complete');
                } else if (step === dispatchState.currentStep) {
                    item.classList.add('active');
                }
            });
        }

        function renderStep(step) {
            if (dispatchInterval) {
                clearInterval(dispatchInterval);
                dispatchInterval = null;
            }
            
            dispatchState.currentStep = step;
            updateStepIndicator();
            stepContent.innerHTML = ''; 

            switch (step) {
                case 1:
                    renderDetailsStep();
                    break;
                case 2:
                    renderConfirmationStep();
                    break;
                case 3:
                    renderDispatchStatusStep(dispatchState.status);
                    break;
            }
        }

        function renderDetailsStep() {
            const data = dispatchState.dispatchData;
            
            // Pre-calculate initial fares for display
            const cabFare = calculateFare('Cab');
            const autoFare = calculateFare('Auto');
            // This ensures fare/distance is consistent when they hit 'Continue'
            
            stepContent.innerHTML = `
                <div class="transport-disclaimer">
                    <p>⚠️ <strong>Disclaimer:</strong> This is a standard transport service. While drivers carry basic first aid kits, for medical emergencies, you must use the Ambulance Service.</p>
                </div>
                <form id="details-form">
                    <div class="form-group">
                        <label for="pickup">Pickup Location (Current Address)</label>
                        <textarea id="pickup" required rows="2">${data.pickup}</textarea>
                    </div>
                    <div class="form-group">
                        <label for="dropoff">Drop-off Location (Destination)</label>
                        <textarea id="dropoff" required rows="2">${data.dropoff}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Choose Vehicle Type</label>
                        <div class="vehicle-selection">
                            <div class="vehicle-option">
                                <input type="radio" id="vehicle-cab" name="vehicle-type" value="Cab" required 
                                    ${data.vehicleType === 'Cab' ? 'checked' : ''}>
                                <label for="vehicle-cab">
                                    ${VEHICLE_RATES.Cab.icon} ${VEHICLE_RATES.Cab.name}
                                    <span class="fare" id="fare-cab">₹${cabFare}*</span>
                                </label>
                            </div>
                            <div class="vehicle-option">
                                <input type="radio" id="vehicle-auto" name="vehicle-type" value="Auto" required
                                    ${data.vehicleType === 'Auto' ? 'checked' : ''}>
                                <label for="vehicle-auto">
                                    ${VEHICLE_RATES.Auto.icon} ${VEHICLE_RATES.Auto.name}
                                    <span class="fare" id="fare-auto">₹${autoFare}*</span>
                                </label>
                            </div>
                        </div>
                        <p style="font-size: 0.8rem; text-align: right; color: #888;">*Estimated fare for 3-8 miles.</p>
                    </div>

                    <div class="form-group">
                        <label for="contact">Contact Number</label>
                        <input type="tel" id="contact" required value="${data.contact}">
                    </div>
                    
                    <button type="submit" class="cta-btn primary-transport" style="width: 100%;">Continue to Fare Confirmation</button>
                </form>
            `;

            document.getElementById('details-form').addEventListener('submit', (e) => {
                e.preventDefault();
                
                // Get selected vehicle type
                const selectedVehicle = document.querySelector('input[name="vehicle-type"]:checked').value;
                const finalFare = calculateFare(selectedVehicle); // Re-calculate to lock in final fare/distance

                // Save data to state
                dispatchState.dispatchData.pickup = document.getElementById('pickup').value;
                dispatchState.dispatchData.dropoff = document.getElementById('dropoff').value;
                dispatchState.dispatchData.vehicleType = selectedVehicle;
                dispatchState.dispatchData.contact = document.getElementById('contact').value;
                dispatchState.dispatchData.fare = finalFare;
                
                renderStep(2);
            });
            
            // Re-calculate fare on radio button change for dynamic display
            document.querySelectorAll('input[name="vehicle-type"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const type = e.target.value;
                    const fare = calculateFare(type);
                    // Update fare display in case the user has a long time on the page
                    document.getElementById(`fare-${type.toLowerCase()}`).textContent = `₹${fare}*`;
                });
            });
        }

        function renderConfirmationStep() {
            const data = dispatchState.dispatchData;
            const vehicleConfig = VEHICLE_RATES[data.vehicleType];
            
            stepContent.innerHTML = `
                <h3>Review & Confirm Your Ride</h3>
                <div class="confirmation-summary">
                    <p><strong>Vehicle Type:</strong> ${vehicleConfig.icon} ${vehicleConfig.name}</p>
                    <p><strong>Pickup:</strong> ${data.pickup}</p>
                    <p><strong>Drop-off:</strong> ${data.dropoff}</p>
                    <p><strong>Estimated Distance:</strong> ${data.distance} miles</p>
                    <p style="font-size: 1.4rem;"><strong>Final Estimated Fare:</strong> <span style="color: var(--accent-color);">₹${data.fare}</span></p>
                    <p style="font-size: 0.9rem; color: var(--cancel-dark);">*Final fare may vary slightly based on traffic and exact route.</p>
                </div>
                <div class="transport-disclaimer">
                    <p>By clicking "Confirm Ride," you agree to the estimated fare and dispatch a driver to your location.</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="button" class="cta-btn" style="background-color: var(--light-accent); color: var(--primary-dark);" onclick="renderStep(1)">Edit Details</button>
                    <button type="button" class="cta-btn primary-transport" style="flex-grow: 1;" onclick="dispatchRide()">CONFIRM RIDE NOW</button>
                </div>
            `;
        }
        
        // --- Dispatch Logic ---

        function dispatchRide() {
            const now = Date.now();
            
            dispatchState.isLive = true;
            dispatchState.status = 'Dispatched';
            dispatchState.timestamp = now;
            // Random ETA between 2 and 6 minutes
            dispatchState.etaMinutes = Math.floor(Math.random() * 5) + 2; 
            
            renderStep(3); 
        }

        // --- Cancellation Logic ---
        function cancelDispatch() {
            clearDispatchState(false); 
            dispatchState.status = 'Canceled';
            renderStep(3);
        }
        
        // --- Status and Tracking Logic ---

        function simulateArrival() {
            dispatchState.status = 'Arrived';
            renderStep(3); 
        }
        
        function renderDispatchStatusStep(status) {
            
            const isFinished = status === 'Arrived' || status === 'Complete';
            const isCanceled = status === 'Canceled';
            const data = dispatchState.dispatchData;
            const vehicle = VEHICLE_RATES[data.vehicleType];

            // Final status screen (Arrived or Canceled)
            if (isFinished || isCanceled) {
                 const statusClass = isCanceled ? 'canceled' : '';
                 const statusColorClass = isCanceled ? 'cancel' : 'success';
                 const statusText = isCanceled 
                    ? '❌ RIDE CANCELED ❌' 
                    : '✅ Driver Status: ARRIVED AT PICKUP ✅';
                 const finalMessage = isCanceled 
                    ? 'The ride has been successfully canceled. You can try requesting another one.'
                    : `Your ${vehicle.name} has arrived. Please verify the contact number and vehicle details.`;
                
                 stepContent.innerHTML = `
                     <div class="dispatch-status ${statusClass}" style="border-color: ${isCanceled ? 'var(--cancel-dark)' : 'var(--success-green)'};">
                         <h2 class="${statusColorClass}">${statusText}</h2>
                         <p class="eta" style="color: ${isCanceled ? 'var(--cancel-dark)' : 'var(--primary-dark)'}; font-size: 1.8rem;">
                             ${isCanceled ? 'SERVICE CANCELED' : 'WAITING FOR PASSENGER'}
                         </p>
                         <p>${finalMessage}</p>
                         ${!isCanceled ? `<p style="font-size: 1.1rem; font-weight: 700;">Final Fare: ₹${data.fare}</p>` : ''}
                         <button type="button" class="cta-btn" onclick="clearDispatchState()" style="margin-top: 20px;">Book New Ride</button>
                     </div>
                 `;
                 return;
            }

            // Status while en route (Tracking Screen)
            const updateCountdown = () => {
                const timeElapsed = (Date.now() - dispatchState.timestamp) / 60000; // Minutes
                let remainingMinutes = Math.max(0, dispatchState.etaMinutes - timeElapsed);
                
                const etaDisplay = document.getElementById('eta-display');
                if (!etaDisplay) {
                    clearInterval(dispatchInterval);
                    dispatchInterval = null;
                    return;
                }
                
                if (remainingMinutes <= 1.0) {
                    etaDisplay.textContent = "ARRIVING SOON";
                    etaDisplay.style.color = 'var(--success-green)';
                    if (remainingMinutes <= 0.2) {
                        clearInterval(dispatchInterval);
                        dispatchInterval = null;
                        setTimeout(simulateArrival, 5000); // Simulate arrival shortly after ETA hits near zero
                    }
                } else {
                    etaDisplay.textContent = `${Math.round(remainingMinutes)} min`;
                }
            };
            
            stepContent.innerHTML = `
                <div class="dispatch-status">
                    <h2 class="success">Ride Confirmed!</h2>
                    <p style="margin-top: 20px;">Your ${vehicle.name} is on the way.</p>
                    <p class="eta" id="eta-display">Calculating...</p>
                    <p style="font-size: 1.1rem; color: var(--primary-dark);"><strong>Driver:</strong> Rohit S. (Rating: 4.8) | <strong>Vehicle No:</strong> DL 10C AB 4567</p>
                    <p class="small-text">Expected Fare: ₹${data.fare}</p>
                    <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
                        <button type="button" class="cta-btn primary-transport" onclick="simulateArrival()">I See My Ride</button>
                        <button type="button" class="cta-btn" style="background-color: var(--cancel-dark);" onclick="cancelDispatch()">Cancel Ride</button>
                    </div>
                </div>
            `;
            
            updateCountdown(); 
            dispatchInterval = setInterval(updateCountdown, 5000);
        }

        // --- Initialization ---

        window.onload = initializeApp;
    </script>
</body>
</html>